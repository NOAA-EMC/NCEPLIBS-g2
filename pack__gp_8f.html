<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>NCEPLIBS-g2: pack_gp.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NCEPLIBS-g2
   &#160;<span id="projectnumber">3.4.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pack__gp_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">pack_gp.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This subroutine determines groups of variable size.  
<a href="#details">More...</a></p>

<p><a href="pack__gp_8f_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a0b39972f65790b8c3b460f4f255481f6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pack__gp_8f.html#a0b39972f65790b8c3b460f4f255481f6">pack_gp</a> (KFILDO, IC, NXY, IS523, MINPK, INC, MISSP, MISSS, JMIN, JMAX, LBIT, NOV, NDG, LX, IBIT, JBIT, KBIT, NOVREF, LBITREF, IER)</td></tr>
<tr class="memdesc:a0b39972f65790b8c3b460f4f255481f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines groups of variable size, but at least of size minpk, the associated max(JMAX) and min(JMIN), the number of bits necessary to hold the values in each group LBIT, the number of values in each group NOV, the number of bits necessary to pack the JMIN values IBIT, the number of bits necessary to pack the LBIT values JBIT, and the number of bits necessary to pack the NOV values KBIT.  <a href="#a0b39972f65790b8c3b460f4f255481f6">More...</a><br/></td></tr>
<tr class="separator:a0b39972f65790b8c3b460f4f255481f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This subroutine determines groups of variable size. </p>
<dl class="section author"><dt>Author</dt><dd>Harry Glahn </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1994-02-01 </dd></dl>

<p>Definition in file <a class="el" href="pack__gp_8f_source.html">pack_gp.f</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="a0b39972f65790b8c3b460f4f255481f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine pack_gp </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>KFILDO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(nxy)&#160;</td>
          <td class="paramname"><em>IC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>NXY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IS523</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>MINPK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>INC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>MISSP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>MISSS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(ndg)&#160;</td>
          <td class="paramname"><em>JMIN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(ndg)&#160;</td>
          <td class="paramname"><em>JMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(ndg)&#160;</td>
          <td class="paramname"><em>LBIT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(ndg)&#160;</td>
          <td class="paramname"><em>NOV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>NDG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>LX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IBIT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>JBIT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>KBIT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>NOVREF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>LBITREF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>IER</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine determines groups of variable size, but at least of size minpk, the associated max(JMAX) and min(JMIN), the number of bits necessary to hold the values in each group LBIT, the number of values in each group NOV, the number of bits necessary to pack the JMIN values IBIT, the number of bits necessary to pack the LBIT values JBIT, and the number of bits necessary to pack the NOV values KBIT. </p>
<p>The routine is designed to determine the groups such that a small number of bits is necessary to pack the data without excessive computations. If all values in the group are zero, the number of bits to use in packing is defined as zero when there can be no missing values; when there can be missing values, the number of bits must be at least 1 to have the capability to recognize the missing value. However, if all values in a group are missing, the number of bits needed is 0, and the unpacker recognizes this. All variables are integer. even though the groups are initially of size minpk or larger, an adjustment between two groups (the lookback procedure) may make a group smaller than minpk. The control on group size is that the sum of the sizes of the two consecutive groups, each of size minpk or larger, is not decreased. When determining the number of bits necessary for packing, the largest value that can be accommodated in, say mbits is 2**mbits-1 this largest value (and the next smallest value) is reserved for the missing value indicator (only) when is523 ne 0. If the dimension NDG is not large enough to hold all the groups, the local value of minpk is increased by 50 percent. this is repeated until ndg will suffice. A diagnostic is printed whenever this happens, which should be very rarely. If it happens often, NDG in subroutine pack should be increased and a corresponding increase in subroutine unpack made. Considerable code is provided so that no more checking for missing values within loops is done than necessary; the added efficiency of this is relatively minor, but does no harm. For grib2, the reference value for the length of groups in nov and for the number of bits necessary to pack group values are determined, and subtracted before jbit and kbit are determined. When 1 or more groups are large compared to the others, the width of all groups must be as large as the largest. A subroutine reduce breaks up large groups into 2 or more to reduce total bits required. If reduce should abort, pack_gp will be executed again without the call to reduce.</p>
<p>PROGRAM HISTORY LOG:</p>
<ul>
<li>1994-02-01 Harry Glahn tdl mos-2000.</li>
<li>1995-06-01 Harry Glahn modified for lmiss error.</li>
<li>1996-07-01 Harry Glahn added misss.</li>
<li>1997-02-01 Harry Glahn removed 4 redundant tests for missp.eq.0; inserted a test to better handle a string of 9999's.</li>
<li>1997-02-01 Harry Glahn added loops to eliminate test for misss when misss = 0.</li>
<li>1997-03-01 Harry Glahn corrected for secondary missing value.</li>
<li>1997-03-01 Harry Glahn corrected for use of local value of minpk.</li>
<li>1997-03-01 Harry Glahn corrected for secondary missing value.</li>
<li>1997-03-01 Harry Glahn changed calculating number of bits through exponents to an array (improved overall packing performance by about 35 percent). Allowed 0 bit for packing JMIN, LBIT, and NOV.</li>
<li>1997-05-01 Harry Glahn a number of changes for efficiency. mod functions eliminated and one ifthen added. Jount removed. Recomputation of bits not made unless necessary after moving points from one group to another. Nendb adjusted to eliminate possibility of very small group at the end. About 8 percent improvement in overall packing. ISKIPA removed; There is always a group b that can become group A. Control on size of group b (statement below 150) added. Added adda, and use of ge and le instead of gt and lt in loop between 150 and 160. IBITBS added to shorten trip through loop.</li>
<li>2000-03-01 Harry Glahn modified for grib2; changed name from packgp.</li>
<li>2001-01-01 Harry Glahn Add comments; ier = 706 substituted for stops; added return; removed statement number 110; added ier.</li>
<li>2001-11-01 Harry Glahn changed some diagnostic formats to allow printing larger numbers</li>
<li>2001-11-01 Harry Glahn added misslx to put maximum value into JMIN when all values missing to agree with grib standard.</li>
<li>2001-11-01 Harry Glahn changed two tests on missp and misss eq 0 to tests on is523. However, missp and misss cannot in general be 0.</li>
<li>2001-11-01 Harry Glahn added call to reduce; defined itest before loops to reduce computation; started large group when all same value.</li>
<li>2001-12-01 Harry Glahn modified and added a few comments.</li>
<li>2002-01-01 Harry Glahn removed loop before 150 to determine a group of all same value.</li>
<li>2002-01-01 Harry Glahn changed mallow from 9999999 to 2**30+1, and made it a parameter.</li>
<li>2002-03-01 Harry Glahn added non fatal ier = 716, 717; removed nendb=nxy above 150; added iersav=0.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">KFILDO</td><td>unit number for output/print file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IC</td><td>array to hold data for packing. The values do not have to be positive at this point, but must be in the range -2**30 to +2**30 (the value of mallow). These integer values will be retained exactly through packing and unpacking. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NXY</td><td>number of values in IC. also treated as its dimension. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IS523</td><td>missing value management 0=data contains no missing values: 1 data contains primary missing values; 2=data contains primary and secondary missing values. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MINPK</td><td>the minimum size of each group, except possibly the last one. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">INC</td><td>the number of values to add to an already existing group in determining whether or not to start a new group. Ideally, this would be 1, but each time inc values are attempted, the max and min of the next minpk values must be found. This is "a loop
    within a loop," and a slightly larger value may give about as good results with slightly less computational time. If inc is le 0, 1 is used, and a diagnostic is output. note: it is expected that INC will equal 1. The code uses inc primarily in the loops starting at statement 180. If INC were 1, there would not need to be loops as such. However, kinc (the local value of INC) is set ge 1 when near the end of the data to forestall a very small group at the end. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MISSP</td><td>when missing points can be present in the data, they will have the value missp or misss. missp is the primary missing value and misss is the secondary missing value. These must not be values that would occur with subtracting the minimum (reference) value or scaling. for example, missp = 0 would not be advisable. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MISSS</td><td>secondary missing value indicator (see missp). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">JMIN</td><td>the minimum of each group (j=1,lx). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">JMAX</td><td>the maximum of each group (j=1,lx). This is not really needed, but since the max of each group must be found, saving it here is cheap in case the user wants it. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">LBIT</td><td>the number of bits necessary to pack each group (j=1,lx). It is assumed the minimum of each group will be removed before packing, and the values to pack will, therefore, all be positive. However, IC does not necessarily contain all positive values. If the overall minimum has been removed (the usual case), then IC will contain only positive values. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">NOV</td><td>the number of values in each group (j=1,lx). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">NDG</td><td>the dimension of JMIN, JMAX, LBIT, and NOV. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">LX</td><td>the number of groups determined. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">IBIT</td><td>the number of bits necessary to pack the JMIN(j) values, j=1,LX. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">JBIT</td><td>the number of bits necessary to pack the LBIT(j) values, j=1,LX. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">KBIT</td><td>the number of bits necessary to pack the NOV(j) values, j=1,LX. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">NOVREF</td><td>reference value for NOV. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">LBITREF</td><td>reference value for LBIT. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">IER</td><td>error return.<ul>
<li>706 value will not pack in 30 bits&ndash;fatal</li>
<li>714 error in reduce&ndash;non-fatal</li>
<li>715 ngp not large enough in reduce&ndash;non-fatal</li>
<li>716 minpk inceased&ndash;non-fatal</li>
<li>717 inc set = 1&ndash;non-fatal</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>Harry Glahn </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1994-02-01 </dd></dl>

<p>Definition at line <a class="el" href="pack__gp_8f_source.html#l00152">152</a> of file <a class="el" href="pack__gp_8f_source.html">pack_gp.f</a>.</p>

<p>References <a class="el" href="reduce_8f_source.html#l00041">reduce()</a>.</p>

<p>Referenced by <a class="el" href="compack_8f_source.html#l00031">compack()</a>, and <a class="el" href="misspack_8f_source.html#l00043">misspack()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a></li><li class="navelem"><a class="el" href="dir_b90aa5a6084b86bdb838378bc1dc161c.html">Hang.Lei</a></li><li class="navelem"><a class="el" href="dir_a172c4a69c8c4fc64ef5d9224f684072.html">noscrub</a></li><li class="navelem"><a class="el" href="dir_dd819178255f7a9ad49a3b8867a6c150.html">docus</a></li><li class="navelem"><a class="el" href="dir_648917924aeb9ce7c1fc0528dd2caf69.html">feature</a></li><li class="navelem"><a class="el" href="dir_d016ec1399c85acecef32bf81e1fad9c.html">dox</a></li><li class="navelem"><a class="el" href="dir_a7b3ebe721b8c60c479822a40383d337.html">src</a></li><li class="navelem"><a class="el" href="pack__gp_8f.html">pack_gp.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
